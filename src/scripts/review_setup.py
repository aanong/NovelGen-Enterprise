"""
è®¾å®šå®¡æŸ¥ä¸å®Œå–„è„šæœ¬ (Setup Reviewer)
ä½¿ç”¨ Gemini 3 Pro å¯¹å°è¯´è®¾å®šè¿›è¡Œé€»è¾‘å®¡æŸ¥ã€æ¼æ´æ£€æµ‹å’Œè‡ªåŠ¨è¡¥å…¨ã€‚
"""
import asyncio
import argparse
import os
import sys
from pathlib import Path
from dotenv import load_dotenv

# Add project root to path
sys.path.append(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))

from langchain_google_genai import ChatGoogleGenerativeAI
from langchain_core.prompts import ChatPromptTemplate

load_dotenv()


class SetupReviewer:
    """è®¾å®šå®¡æŸ¥ä¸“å®¶ Agent"""
    
    def __init__(self):
        self.llm = ChatGoogleGenerativeAI(
            model="models/gemini-3-pro-preview",
            temperature=0.3,  # å®¡æŸ¥æ—¶éœ€è¦æ›´ä¸¥è°¨
            google_api_key=os.getenv("GOOGLE_API_KEY")
        )
    
    async def review_and_enhance(self, raw_setup: str) -> dict:
        """
        å¯¹åŸå§‹è®¾å®šè¿›è¡Œå…¨æ–¹ä½å®¡æŸ¥å’Œå¢å¼º
        
        Returns:
            {
                "logic_issues": List[str],  # å‘ç°çš„é€»è¾‘æ¼æ´
                "cultivation_analysis": str,  # ä¿®ç‚¼ä½“ç³»åˆ†æ
                "enhanced_outline": str,  # å®Œå–„åçš„å¤§çº²
                "character_relations": str,  # è¡¥å……çš„äººç‰©å…³ç³»ç½‘
                "world_locations": str,  # è¡¥å……çš„åœ°ç†ä½ç½®
                "final_setup": str  # æœ€ç»ˆå®Œå–„ç‰ˆè®¾å®š
            }
        """
        
        review_prompt = ChatPromptTemplate.from_messages([
            ("system", (
                "ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ç„å¹»å°è¯´ä¸–ç•Œè§‚æ¶æ„å¸ˆå’Œé€»è¾‘å®¡æŸ¥ä¸“å®¶ã€‚\n"
                "ä½ çš„ä»»åŠ¡æ˜¯å¯¹ç”¨æˆ·æä¾›çš„å°è¯´è®¾å®šè¿›è¡Œæ·±åº¦åˆ†æï¼Œæ‰¾å‡ºä»¥ä¸‹é—®é¢˜ï¼š\n"
                "1. **é€»è¾‘æ¼æ´**ï¼šä¿®ç‚¼ä½“ç³»æ˜¯å¦è‡ªæ´½ï¼Ÿå¢ƒç•Œåˆ’åˆ†æ˜¯å¦åˆç†ï¼Ÿ\n"
                "2. **äººç‰©å…³ç³»**ï¼šè§’è‰²ä¹‹é—´çš„å…³ç³»ç½‘æ˜¯å¦å®Œæ•´ï¼Ÿæ˜¯å¦æœ‰é—æ¼çš„é‡è¦å…³ç³»ï¼Ÿ\n"
                "3. **åœ°ç†ä½“ç³»**ï¼šä¸–ç•Œçš„ç©ºé—´ç»“æ„æ˜¯å¦æ¸…æ™°ï¼Ÿå…³é”®åœ°ç‚¹æ˜¯å¦éƒ½æœ‰æè¿°ï¼Ÿ\n"
                "4. **å¤§çº²å®Œæ•´æ€§**ï¼šå‰§æƒ…èŠ‚å¥æ˜¯å¦åˆç†ï¼Ÿæ˜¯å¦æœ‰è·³è·ƒæˆ–æ–­å±‚ï¼Ÿ\n\n"
                "**ç‰¹åˆ«è¦æ±‚**ï¼š\n"
                "- åœ¨æ‰©å±•äººç‰©ã€åœ°ç‚¹ã€åŠ¿åŠ›æ—¶ï¼Œå¿…é¡»å‚ç…§ã€Šå±±æµ·ç»ã€‹ã€Šæ˜“ç»ã€‹ã€Šè¯—ç»ã€‹ã€Šæ·®å—å­ã€‹ã€Šæ¥šè¾ã€‹ã€Šæœç¥è®°ã€‹è¿›è¡Œå‘½åã€‚\n"
                "- äººç‰©åï¼šå¯ç”¨ã€Šè¯—ç»ã€‹ä¸­çš„æ„è±¡ï¼ˆå¦‚'é‡‡è–‡''è’¹è‘­''æ¸…æ‰¬'ï¼‰æˆ–ã€Šæ˜“ç»ã€‹å¦è±¡ï¼ˆå¦‚'ä¹¾å…ƒ''å¤å¾·''ç¦»æ˜'ï¼‰ã€‚\n"
                "- åœ°ç‚¹åï¼šå‚è€ƒã€Šå±±æµ·ç»ã€‹çš„å±±å·åï¼ˆå¦‚'ä¸å‘¨å±±''å½’å¢Ÿ''æ‰¶æ¡‘''é’ä¸˜'ï¼‰ã€ã€Šæ·®å—å­ã€‹çš„å¤©æ–‡åœ°ç†ï¼ˆå¦‚'ä¹å·''å››æµ·''å…«æ'ï¼‰ã€ã€Šæ¥šè¾ã€‹çš„ç¥è¯ç©ºé—´ï¼ˆå¦‚'é˜Šé˜–''ç‘¶å°''äº‘æ¢¦'ï¼‰ã€‚\n"
                "- å¼‚å…½/ç¥ç‰©ï¼šå‚è€ƒã€Šæœç¥è®°ã€‹ã€Šå±±æµ·ç»ã€‹ä¸­çš„ç¥å…½ï¼ˆå¦‚'çƒ›é¾™''æ¯•æ–¹''é²²é¹''ä¹å°¾ç‹'ï¼‰ã€‚\n"
                "- åŠ¿åŠ›åï¼šç»“åˆå¤å…¸æ„è±¡ï¼Œä½“ç°å…¶ç‰¹è´¨ï¼ˆå¦‚'è“¬è±ä»™é˜''å½’è—ä¹¦é™¢''å¤ªç„é“å®—'ï¼‰ã€‚\n\n"
                "è¯·ä»¥ä¸“ä¸šç¼–è¾‘çš„è§’åº¦ï¼Œæä¾›è¯¦ç»†çš„å®¡æŸ¥æŠ¥å‘Šå’Œæ”¹è¿›å»ºè®®ã€‚"
            )),
            ("human", (
                "ä»¥ä¸‹æ˜¯å°è¯´çš„åŸå§‹è®¾å®šæ–‡æ¡£ï¼š\n\n"
                "```\n{raw_setup}\n```\n\n"
                "è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºä½ çš„å®¡æŸ¥ç»“æœï¼š\n\n"
                "## ä¸€ã€é€»è¾‘æ¼æ´æ£€æµ‹ä¸ä¿®å¤æ–¹æ¡ˆ\n"
                "[è¯¦ç»†åˆ—å‡ºå‘ç°çš„æ‰€æœ‰é€»è¾‘é—®é¢˜ï¼Œå¹¶ä¸ºæ¯ä¸ªé—®é¢˜æä¾›å…·ä½“çš„ä¿®å¤æ–¹æ¡ˆ]\n\n"
                "## äºŒã€ä¿®ç‚¼ä½“ç³»æ·±åº¦åˆ†æä¸é‡æ„\n"
                "[è¯„ä¼°ä¿®ç‚¼ä½“ç³»çš„å®Œæ•´æ€§å’Œåˆç†æ€§ï¼Œå¿…è¦æ—¶é‡æ„ï¼Œå¹¶æä¾›å¯¹ç…§è¡¨]\n\n"
                "## ä¸‰ã€äººç‰©æ‰©å±•ä¸å…³ç³»ç½‘\n"
                "[åŸºäºç°æœ‰äººç‰©ï¼Œæ‰©å±•ä»¥ä¸‹å†…å®¹ï¼š]\n"
                "- **ä¸»è¦äººç‰©æ·±åŒ–**ï¼šä¸ºç°æœ‰è§’è‰²è¡¥å……èƒŒæ™¯æ•…äº‹ã€æ€§æ ¼å¼§å…‰ã€æ ¸å¿ƒåŠ¨æœºã€ç¦å¿Œä¸è½¯è‚‹\n"
                "- **é…è§’è¡¥å……**ï¼šå¢åŠ è‡³å°‘ 80-120 ä¸ªå…³é”®é…è§’ï¼ˆç›Ÿå‹ã€æ•Œäººã€å¯¼å¸ˆã€è·¯äººè½¬æŠ˜ç‚¹ã€ä¸­ç«‹è§‚å¯Ÿè€…ï¼‰\n"
                "- **åæ´¾ä½“ç³»**ï¼šæ„å»ºå®Œæ•´çš„åæ´¾é˜¶æ¢¯ï¼ˆç‚®ç° â†’ å°BOSS â†’ ä¸­BOSS â†’ å¤§BOSS â†’ æœ€ç»ˆBOSSï¼‰\n"
                "- **äººç‰©å…³ç³»å›¾è°±**ï¼šç”¨è¡¨æ ¼å½¢å¼å±•ç¤ºæ‰€æœ‰äººç‰©çš„å…³ç³»ç½‘ï¼ˆåŒ…æ‹¬æ•Œå¯¹åº¦ã€å¥½æ„Ÿåº¦ã€åˆ©ç›Šå…³ç³»ï¼‰\n"
                "- **å‘½åè§„èŒƒ**ï¼šæ‰€æœ‰æ–°å¢äººç‰©å¿…é¡»å‚ç…§ã€Šè¯—ç»ã€‹ã€Šæ˜“ç»ã€‹ã€Šæ¥šè¾ã€‹å‘½åï¼Œå¹¶æ³¨æ˜å‡ºå¤„å’Œå¯“æ„\n\n"
                "## å››ã€ä¸–ç•Œåœ°ç†æ·±åº¦æ‰©å±•\n"
                "[åŸºäºç°æœ‰åœ°ç†ï¼Œæ‰©å±•ä»¥ä¸‹å†…å®¹ï¼š]\n"
                "- **æ ¸å¿ƒåŒºåŸŸè¯¦è¿°**ï¼šä¸ºæ¯ä¸ªä¸»è¦åœ°ç‚¹è¡¥å……åœ°ç†ç‰¹å¾ã€æ°”å€™ã€èµ„æºåˆ†å¸ƒã€åŠ¿åŠ›æ§åˆ¶ã€å†å²ä¼ è¯´\n"
                "- **æ–°å¢åœ°ç‚¹**ï¼šè¡¥å……è‡³å°‘ 15-20 ä¸ªå…³é”®åœ°ç‚¹ï¼Œåˆ†ç±»å¦‚ä¸‹ï¼š\n"
                "  * ä¿®ç‚¼åœ£åœ°ï¼ˆ30-50ä¸ªï¼‰ï¼šå¦‚æ´å¤©ç¦åœ°ã€çµè„‰æ±‡èšä¹‹æ‰€\n"
                "  * ç¦åœ°é™©å¢ƒï¼ˆ10-15ä¸ªï¼‰ï¼šå¦‚ç»åœ°ã€æ­»åŸŸã€æ—¶ç©ºä¹±æµ\n"
                "  * æˆ˜åœºé—è¿¹ï¼ˆ20-30ä¸ªï¼‰ï¼šä¸Šå¤æˆ˜åœºã€å°å°ä¹‹åœ°\n"
                "  * éšç§˜ä¹‹æ‰€ï¼ˆ20-30ä¸ªï¼‰ï¼šç§˜å¢ƒã€å¼‚ç©ºé—´\n"
                "  * åŸå¸‚èšè½ï¼ˆ30-50ä¸ªï¼‰ï¼šä¿®ä»™åŠå¸‚ã€å‡¡äººç‹æœ\n"
                "- **ç©ºé—´ç»“æ„**ï¼šæ˜ç¡®å„åŒºåŸŸçš„å±‚çº§å…³ç³»ï¼ˆå¦‚ï¼šå‡¡ç•Œ â†’ çµç•Œ â†’ ç¥ç•Œ â†’ æ··æ²Œï¼‰\n"
                "- **ä¼ é€ä½“ç³»**ï¼šè¯´æ˜è§’è‰²å¦‚ä½•åœ¨ä¸åŒåŒºåŸŸé—´ç§»åŠ¨ï¼ˆä¼ é€é˜µã€ç©ºé—´è£‚ç¼ã€é£èˆŸç­‰ï¼‰\n"
                "- **å¼‚å…½åˆ†å¸ƒ**ï¼šä¸ºæ¯ä¸ªåŒºåŸŸé…ç½®ç‰¹è‰²å¼‚å…½æˆ–ç¥ç‰©ï¼ˆå‚è€ƒã€Šå±±æµ·ç»ã€‹ã€Šæœç¥è®°ã€‹ï¼‰\n"
                "- **å‘½åè§„èŒƒ**ï¼šæ‰€æœ‰åœ°ç‚¹å¿…é¡»å‚ç…§ã€Šå±±æµ·ç»ã€‹ã€Šæ·®å—å­ã€‹ã€Šæ¥šè¾ã€‹å‘½åï¼Œå¹¶æ³¨æ˜å‡ºå¤„\n\n"
                "## äº”ã€åŠ¿åŠ›æ‰©å±•ä¸æ”¿æ²»æ ¼å±€\n"
                "[åŸºäºç°æœ‰åŠ¿åŠ›ï¼Œæ‰©å±•ä»¥ä¸‹å†…å®¹ï¼š]\n"
                "- **åŠ¿åŠ›è¯¦è¿°**ï¼šä¸ºæ¯ä¸ªåŠ¿åŠ›è¡¥å……ç»„ç»‡æ¶æ„ã€æ ¸å¿ƒç†å¿µã€å†å²æ¸Šæºã€æ‹›æ”¶æ ‡å‡†ã€ç¦å¿Œ\n"
                "- **æ–°å¢åŠ¿åŠ›**ï¼šè¡¥å……è‡³å°‘ 80 ä¸ªåŠ¿åŠ›ï¼Œåˆ†ç±»å¦‚ä¸‹ï¼š\n"
                "  * æ­£é“å®—é—¨ï¼ˆ20-30ä¸ªï¼‰\n"
                "  * é­”é“åŠ¿åŠ›ï¼ˆ20-30ä¸ªï¼‰\n"
                "  * ä¸­ç«‹ç»„ç»‡ï¼ˆ10-20ä¸ªï¼‰\n"
                "  * éšä¸–é—¨æ´¾ï¼ˆ10-20ä¸ªï¼‰\n"
                "- **åŠ¿åŠ›å…³ç³»å›¾**ï¼šç”¨è¡¨æ ¼å±•ç¤ºå„åŠ¿åŠ›çš„æ•Œå¯¹/ç›Ÿå‹/ä¸­ç«‹å…³ç³»ï¼Œä»¥åŠåˆ©ç›Šçº è‘›\n"
                "- **æƒåŠ›å¹³è¡¡**ï¼šè¯´æ˜å„åŠ¿åŠ›å¦‚ä½•åˆ¶è¡¡ï¼Œé¿å…ä¸€å®¶ç‹¬å¤§\n"
                "- **å‘½åè§„èŒƒ**ï¼šæ‰€æœ‰åŠ¿åŠ›å¿…é¡»ç»“åˆå¤å…¸æ„è±¡ï¼Œä½“ç°å…¶ç‰¹è´¨\n\n"
                "- **åŠ¿åŠ›åˆ†å¸ƒ**ï¼šå°†è¿™äº›åŠ¿åŠ›åˆ†å¸ƒåˆ°æ¯ä¸€ä¸ªå·\n\n"
                "## å…­ã€å®Œæ•´ç« èŠ‚ç›®å½•ï¼ˆåŸºäºä¿®å¤åçš„è®¾å®šï¼‰\n"
                "[æ ¹æ®ä¿®å¤åçš„é€»è¾‘æ¼æ´ã€æ‰©å±•åçš„äººç‰©å…³ç³»å’Œåœ°ç†ä½“ç³»ï¼Œç”Ÿæˆå®Œæ•´çš„ç« èŠ‚ç›®å½•ï¼š]\n"
                "- **æ ¼å¼è¦æ±‚**ï¼š\n"
                "  * åˆ†å·ç»“æ„ï¼šç¬¬Xå·ï¼šã€å·åã€‘ï¼ˆæ€»ç« èŠ‚æ•°ï¼‰\n"
                "  * æ¯å·ä¸‹åˆ—å‡ºæ‰€æœ‰ç« èŠ‚ï¼šç¬¬Xç« ï¼šã€ç« èŠ‚åã€‘ - æ ¸å¿ƒäº‹ä»¶æ¦‚è¿°ï¼ˆ1-2å¥è¯ï¼‰\n"
                "  * æ ‡æ³¨å…³é”®è½¬æŠ˜ç‚¹ã€é«˜æ½®ç« èŠ‚ã€ä¼ç¬”åŸ‹è®¾ç« èŠ‚\n"
                "- **å†…å®¹è¦æ±‚**ï¼š\n"
                "  * ç¡®ä¿æ¯ä¸ªæ‰©å±•çš„äººç‰©éƒ½æœ‰å‡ºåœºç« èŠ‚\n"
                "  * ç¡®ä¿æ¯ä¸ªå…³é”®åœ°ç‚¹éƒ½æœ‰å¯¹åº”çš„æ¢ç´¢ç« èŠ‚\n"
                "  * ç¡®ä¿åŠ¿åŠ›å†²çªæœ‰å®Œæ•´çš„é“ºå«-çˆ†å‘-æ”¶å°¾æµç¨‹\n"
                "  * æ€»ç« èŠ‚æ•°å»ºè®®ï¼š1000-1500ç« ï¼ˆé•¿ç¯‡å°è¯´æ ‡å‡†ï¼‰\n\n"
                "## ä¸ƒã€æœ€ç»ˆå®Œå–„ç‰ˆè®¾å®šæ–‡æ¡£\n"
                "[è¾“å‡ºä¿®æ­£åçš„å®Œæ•´è®¾å®šæ–‡æ¡£ï¼Œä¿æŒåŸæ ¼å¼ï¼Œæ•´åˆä»¥ä¸Šæ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ï¼š]\n"
                "- ä¿®å¤åçš„ä¸–ç•Œè§‚\n"
                "- å®Œæ•´çš„äººç‰©åˆ—è¡¨ï¼ˆå«æ–°å¢è§’è‰²ï¼‰\n"
                "- å®Œæ•´çš„åœ°ç†ä½“ç³»ï¼ˆå«æ–°å¢åœ°ç‚¹ï¼‰\n"
                "- å®Œæ•´çš„åŠ¿åŠ›ä½“ç³»\n"
                "- ä¿®ç‚¼ä½“ç³»å¯¹ç…§è¡¨\n"
                "- æ–‡é£è¦æ±‚"
            ))
        ])
        
        print("ğŸ” æ­£åœ¨è°ƒç”¨ Gemini 3 Pro è¿›è¡Œæ·±åº¦å®¡æŸ¥...")
        response = await self.llm.ainvoke(
            review_prompt.format(raw_setup=raw_setup)
        )
        
        content = response.content
        
        # è§£æè¿”å›çš„ç»“æ„åŒ–å†…å®¹
        sections = {
            "logic_fixes": self._extract_section(content, "ä¸€ã€é€»è¾‘æ¼æ´æ£€æµ‹ä¸ä¿®å¤æ–¹æ¡ˆ"),
            "cultivation_system": self._extract_section(content, "äºŒã€ä¿®ç‚¼ä½“ç³»æ·±åº¦åˆ†æä¸é‡æ„"),
            "character_expansion": self._extract_section(content, "ä¸‰ã€äººç‰©æ‰©å±•ä¸å…³ç³»ç½‘"),
            "world_geography": self._extract_section(content, "å››ã€ä¸–ç•Œåœ°ç†æ·±åº¦æ‰©å±•"),
            "faction_politics": self._extract_section(content, "äº”ã€åŠ¿åŠ›æ‰©å±•ä¸æ”¿æ²»æ ¼å±€"),
            "chapter_directory": self._extract_section(content, "å…­ã€å®Œæ•´ç« èŠ‚ç›®å½•"),
            "final_setup": self._extract_section(content, "ä¸ƒã€æœ€ç»ˆå®Œå–„ç‰ˆè®¾å®šæ–‡æ¡£")
        }
        
        return sections
    
    def _extract_section(self, content: str, section_title: str) -> str:
        """ä» Markdown æ ¼å¼ä¸­æå–ç‰¹å®šç« èŠ‚"""
        lines = content.split('\n')
        capturing = False
        result = []
        
        for line in lines:
            if section_title in line:
                capturing = True
                continue
            if capturing:
                # é‡åˆ°ä¸‹ä¸€ä¸ªä¸»æ ‡é¢˜å°±åœæ­¢
                if line.startswith('## ') and section_title not in line:
                    break
                result.append(line)
        
        extracted = '\n'.join(result).strip()
        
        # å¦‚æœæ˜¯æœ€ç»ˆè®¾å®šä¸”ä¸ºç©ºï¼Œè¿”å›åŸå§‹å†…å®¹
        if not extracted and "æœ€ç»ˆå®Œå–„ç‰ˆè®¾å®š" in section_title:
            return content
        
        return extracted


async def main(input_file: str, output_dir: str = "./reviewed_setups"):
    """ä¸»æµç¨‹"""
    print(f"ğŸ“‚ è¯»å–è®¾å®šæ–‡ä»¶: {input_file}")
    
    if not os.path.exists(input_file):
        print("âŒ æ–‡ä»¶ä¸å­˜åœ¨")
        return
    
    with open(input_file, "r", encoding="utf-8") as f:
        raw_setup = f.read()
    
    reviewer = SetupReviewer()
    
    try:
        result = await reviewer.review_and_enhance(raw_setup)
        
        # åˆ›å»ºè¾“å‡ºç›®å½•
        os.makedirs(output_dir, exist_ok=True)
        
        # ä¿å­˜å®¡æŸ¥æŠ¥å‘Š
        report_path = os.path.join(output_dir, "review_report.md")
        with open(report_path, "w", encoding="utf-8") as f:
            f.write("# å°è¯´è®¾å®šæ·±åº¦å®¡æŸ¥æŠ¥å‘Š\n\n")
            f.write("## ä¸€ã€é€»è¾‘æ¼æ´æ£€æµ‹ä¸ä¿®å¤æ–¹æ¡ˆ\n")
            f.write(result["logic_fixes"] + "\n\n")
            f.write("## äºŒã€ä¿®ç‚¼ä½“ç³»æ·±åº¦åˆ†æä¸é‡æ„\n")
            f.write(result["cultivation_system"] + "\n\n")
            f.write("## ä¸‰ã€äººç‰©æ‰©å±•ä¸å…³ç³»ç½‘\n")
            f.write(result["character_expansion"] + "\n\n")
            f.write("## å››ã€ä¸–ç•Œåœ°ç†æ·±åº¦æ‰©å±•\n")
            f.write(result["world_geography"] + "\n\n")
            f.write("## äº”ã€åŠ¿åŠ›æ‰©å±•ä¸æ”¿æ²»æ ¼å±€\n")
            f.write(result["faction_politics"] + "\n\n")
            f.write("## å…­ã€å®Œæ•´ç« èŠ‚ç›®å½•\n")
            f.write(result["chapter_directory"] + "\n\n")
        
        print(f"âœ… å®¡æŸ¥æŠ¥å‘Šå·²ä¿å­˜è‡³: {report_path}")
        
        # ä¿å­˜å®Œå–„åçš„è®¾å®š
        enhanced_path = os.path.join(output_dir, "enhanced_setup.txt")
        with open(enhanced_path, "w", encoding="utf-8") as f:
            f.write(result["final_setup"])
        
        print(f"âœ… å®Œå–„åçš„è®¾å®šå·²ä¿å­˜è‡³: {enhanced_path}")
        print("\n" + "="*60)
        print("ğŸ‰ å®¡æŸ¥å®Œæˆï¼ä½ å¯ä»¥ï¼š")
        print(f"1. æŸ¥çœ‹å®¡æŸ¥æŠ¥å‘Š: {report_path}")
        print(f"2. ä½¿ç”¨å®Œå–„åçš„è®¾å®šå¯¼å…¥ç³»ç»Ÿ:")
        print(f"   python -m src.scripts.import_novel {enhanced_path}")
        
    except Exception as e:
        print(f"âŒ å®¡æŸ¥è¿‡ç¨‹å‡ºé”™: {e}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="å®¡æŸ¥å¹¶å®Œå–„å°è¯´è®¾å®š")
    parser.add_argument("file", help="è®¾å®šæ–‡ä»¶è·¯å¾„")
    parser.add_argument("--output", default="./reviewed_setups", help="è¾“å‡ºç›®å½•")
    args = parser.parse_args()
    
    asyncio.run(main(args.file, args.output))
