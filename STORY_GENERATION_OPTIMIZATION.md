# å°è¯´ç”Ÿæˆæµç¨‹ä¼˜åŒ–æŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2026-01-07  
**åˆ†æèŒƒå›´**: è¿è´¯æ€§ã€èµ„æ–™ä½¿ç”¨ã€å‰§æƒ…çº¿å®Œæ•´åº¦

---

## ğŸ“Š å½“å‰æµç¨‹åˆ†æ

### ç°æœ‰æµç¨‹æ¦‚è§ˆ

```
load_context â†’ plan â†’ refine_context â†’ write â†’ review â†’ evolve
     â†“           â†“          â†“            â†“        â†“        â†“
  åŠ è½½çŠ¶æ€   è§„åˆ’ç« èŠ‚   RAGæ£€ç´¢   æ’°å†™æ­£æ–‡  é€»è¾‘å®¡æŸ¥  äººç‰©æ¼”åŒ–
```

---

## ğŸ” é—®é¢˜è¯†åˆ«ä¸ä¼˜åŒ–å»ºè®®

### ä¸€ã€å°è¯´è¿è´¯æ€§ä¼˜åŒ–

#### é—®é¢˜ 1: ç« èŠ‚æ‘˜è¦è´¨é‡ä¸è¶³

**ç°çŠ¶**:
- `generate_chapter_summary()` åªæ˜¯ç®€å•æˆªå–å‰200å­—
- æ‘˜è¦æ— æ³•åæ˜ ç« èŠ‚çš„æ ¸å¿ƒäº‹ä»¶å’Œå…³é”®ä¿¡æ¯
- åç»­ç« èŠ‚æ— æ³•å‡†ç¡®ç†è§£å‰æ–‡å†…å®¹

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **ä½¿ç”¨ LLM ç”Ÿæˆé«˜è´¨é‡æ‘˜è¦**
   ```python
   async def generate_chapter_summary_llm(content: str, state: NGEState) -> str:
       """ä½¿ç”¨ LLM ç”Ÿæˆç»“æ„åŒ–æ‘˜è¦"""
       prompt = f"""
       è¯·ä¸ºä»¥ä¸‹ç« èŠ‚ç”Ÿæˆæ‘˜è¦ï¼Œå¿…é¡»åŒ…å«ï¼š
       1. æ ¸å¿ƒäº‹ä»¶ï¼ˆ1-2å¥è¯ï¼‰
       2. å…³é”®äººç‰©çŠ¶æ€å˜åŒ–
       3. æ–°å‡ºç°çš„ä¼ç¬”æˆ–çº¿ç´¢
       4. ä¸ä¸»çº¿çš„å…³è”
       
       ç« èŠ‚å†…å®¹ï¼š
       {content[:3000]}  # é™åˆ¶é•¿åº¦é¿å…tokenæµªè´¹
       """
       # è°ƒç”¨ LLM ç”Ÿæˆæ‘˜è¦
   ```

2. **ç»“æ„åŒ–æ‘˜è¦æ ¼å¼**
   - æ ¸å¿ƒäº‹ä»¶
   - äººç‰©å˜åŒ–
   - ä¼ç¬”çº¿ç´¢
   - å‰§æƒ…æ¨è¿›

3. **æ‘˜è¦éªŒè¯æœºåˆ¶**
   - æ£€æŸ¥æ‘˜è¦æ˜¯å¦åŒ…å«å…³é”®ä¿¡æ¯
   - ç¡®ä¿ä¸å‰æ–‡æ‘˜è¦çš„è¿è´¯æ€§

**ä¼˜å…ˆçº§**: â­â­â­â­â­ (é«˜)

---

#### é—®é¢˜ 2: ç« èŠ‚é—´é€»è¾‘è¿æ¥æ£€æŸ¥ç¼ºå¤±

**ç°çŠ¶**:
- åªåŠ è½½å†å²æ‘˜è¦ï¼Œä¸æ£€æŸ¥é€»è¾‘è¿æ¥
- å¯èƒ½å‡ºç°å‰§æƒ…è·³è·ƒæˆ–çŸ›ç›¾
- æ²¡æœ‰éªŒè¯æœ¬ç« æ˜¯å¦åˆç†æ‰¿æ¥å‰æ–‡

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **åœ¨ plan èŠ‚ç‚¹æ·»åŠ è¿è´¯æ€§æ£€æŸ¥**
   ```python
   async def check_chapter_coherence(state: NGEState, plan_data: dict) -> dict:
       """æ£€æŸ¥ç« èŠ‚è¿è´¯æ€§"""
       # 1. æ£€æŸ¥ä¸å‰æ–‡ç»“å°¾çš„è¡”æ¥
       # 2. éªŒè¯äººç‰©çŠ¶æ€è¿ç»­æ€§
       # 3. æ£€æŸ¥æ—¶é—´çº¿åˆç†æ€§
       # 4. éªŒè¯åœ°ç‚¹/åœºæ™¯è½¬æ¢åˆç†æ€§
   ```

2. **åˆ›å»ºè¿è´¯æ€§æ£€æŸ¥ Agent**
   - ä¸“é—¨è´Ÿè´£æ£€æŸ¥ç« èŠ‚é—´çš„é€»è¾‘è¿æ¥
   - åœ¨ plan å’Œ review é˜¶æ®µéƒ½è¿›è¡Œæ£€æŸ¥

3. **æ·»åŠ è¿è´¯æ€§è¯„åˆ†**
   - è¯„åˆ†ä½äºé˜ˆå€¼æ—¶è§¦å‘ä¿®æ­£æµç¨‹

**ä¼˜å…ˆçº§**: â­â­â­â­ (ä¸­é«˜)

---

#### é—®é¢˜ 3: å…³é”®äº‹ä»¶å¼•ç”¨ä¸è¶³

**ç°çŠ¶**:
- åªä½¿ç”¨ç« èŠ‚æ‘˜è¦ï¼Œå¯èƒ½é—æ¼å…³é”®ç»†èŠ‚
- æ²¡æœ‰æ˜¾å¼å¼•ç”¨å‰æ–‡çš„é‡è¦äº‹ä»¶
- äººç‰©å…³ç³»å˜åŒ–å¯èƒ½è¢«å¿½ç•¥

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **æå–å…³é”®äº‹ä»¶ç´¢å¼•**
   ```python
   class KeyEventIndex:
       """å…³é”®äº‹ä»¶ç´¢å¼•"""
       events: List[Dict]  # {chapter, event, characters, impact}
       
   async def extract_key_events(chapter_content: str) -> List[Dict]:
       """ä»ç« èŠ‚ä¸­æå–å…³é”®äº‹ä»¶"""
   ```

2. **åœ¨ load_context ä¸­åŠ è½½å…³é”®äº‹ä»¶**
   - ä¸ä»…åŠ è½½æ‘˜è¦ï¼Œè¿˜åŠ è½½å…³é”®äº‹ä»¶
   - æŒ‰é‡è¦æ€§æ’åºï¼Œä¼˜å…ˆåŠ è½½é«˜å½±å“äº‹ä»¶

3. **åœ¨ plan å’Œ write é˜¶æ®µæ˜¾å¼å¼•ç”¨**
   - æç¤ºè¯ä¸­åŒ…å«"å‰æ–‡å…³é”®äº‹ä»¶å›é¡¾"
   - ç¡®ä¿é‡è¦äº‹ä»¶ä¸è¢«é—å¿˜

**ä¼˜å…ˆçº§**: â­â­â­â­ (ä¸­é«˜)

---

### äºŒã€èµ„æ–™ä½¿ç”¨ä¼˜åŒ–

#### é—®é¢˜ 4: RAG æ£€ç´¢èŒƒå›´æœ‰é™

**ç°çŠ¶**:
- åªåœ¨ `refine_context` èŠ‚ç‚¹æ£€ç´¢ä¸–ç•Œè§‚å’Œæ–‡é£
- æ£€ç´¢çš„ query åªæ˜¯åœºæ™¯æè¿°ï¼Œå¯èƒ½ä¸å¤Ÿç²¾å‡†
- æ²¡æœ‰åˆ©ç”¨ ReferenceMaterial ä¸­çš„å‰§æƒ…å¥—è·¯ã€äººç‰©åŸå‹ç­‰

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **æ‰©å±•æ£€ç´¢èŒƒå›´**
   ```python
   async def enhanced_rag_search(state: NGEState, plan_data: dict):
       """å¢å¼ºçš„ RAG æ£€ç´¢"""
       # 1. ä¸–ç•Œè§‚è®¾å®šï¼ˆå·²æœ‰ï¼‰
       bible_results = await vs.search_bible(query, top_k=5)
       
       # 2. æ–‡é£å‚è€ƒï¼ˆå·²æœ‰ï¼Œä½†å¢åŠ æ•°é‡ï¼‰
       style_results = await vs.search_style(query, top_k=3)  # ä»1å¢åŠ åˆ°3
       
       # 3. æ–°å¢ï¼šå‰§æƒ…å¥—è·¯æ£€ç´¢
       plot_tropes = await vs.search_references(
           query, 
           top_k=2, 
           category="plot_trope"
       )
       
       # 4. æ–°å¢ï¼šäººç‰©åŸå‹æ£€ç´¢
       character_archetypes = await vs.search_references(
           query,
           top_k=2,
           category="character_archetype"
       )
       
       # 5. æ–°å¢ï¼šç±»ä¼¼åœºæ™¯å‚è€ƒ
       similar_scenes = await vs.search_references(
           f"{query} {plan_data.get('scene_description', '')}",
           top_k=2,
           category="world_setting"
       )
   ```

2. **å¤šé˜¶æ®µæ£€ç´¢**
   - **Plan é˜¶æ®µ**: æ£€ç´¢å‰§æƒ…å¥—è·¯å’Œäººç‰©åŸå‹ï¼Œè¾…åŠ©è§„åˆ’
   - **Refine é˜¶æ®µ**: æ£€ç´¢ä¸–ç•Œè§‚å’Œæ–‡é£ï¼Œç²¾ç‚¼ä¸Šä¸‹æ–‡
   - **Write é˜¶æ®µ**: æ ¹æ®å®é™…å†™ä½œå†…å®¹åŠ¨æ€æ£€ç´¢è¡¥å……èµ„æ–™

3. **æ£€ç´¢ Query ä¼˜åŒ–**
   ```python
   def build_rag_query(state: NGEState, plan_data: dict) -> str:
       """æ„å»ºæ›´ç²¾å‡†çš„ RAG æŸ¥è¯¢"""
       # ç»„åˆå¤šä¸ªä¿¡æ¯æº
       query_parts = [
           plan_data.get("scene_description", ""),
           plan_data.get("key_conflict", ""),
           # å½“å‰ç« èŠ‚æ¶‰åŠçš„äººç‰©
           ", ".join([c.name for c in state.characters.values() if c.current_mood]),
           # å½“å‰å‰§æƒ…ç‚¹
           state.plot_progress[state.current_plot_index].description if state.current_plot_index < len(state.plot_progress) else ""
       ]
       return " ".join([p for p in query_parts if p])
   ```

**ä¼˜å…ˆçº§**: â­â­â­â­â­ (é«˜)

---

#### é—®é¢˜ 5: æ–‡é£å‚è€ƒä½¿ç”¨ä¸è¶³

**ç°çŠ¶**:
- åªæ£€ç´¢1æ¡æ–‡é£å‚è€ƒ
- æ–‡é£å‚è€ƒåªæ˜¯ç®€å•æ‹¼æ¥ï¼Œæ²¡æœ‰åˆ†æ
- æ²¡æœ‰æ ¹æ®åœºæ™¯ç±»å‹é€‰æ‹©ä¸åŒçš„æ–‡é£å‚è€ƒ

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **å¤šæ–‡é£å‚è€ƒèåˆ**
   ```python
   async def get_style_references(state: NGEState, scene_type: str) -> str:
       """è·å–åœºæ™¯ç›¸å…³çš„æ–‡é£å‚è€ƒ"""
       # æ ¹æ®åœºæ™¯ç±»å‹æ£€ç´¢ä¸åŒçš„æ–‡é£
       if scene_type == "Action":
           query = "åŠ¨ä½œåœºæ™¯ æˆ˜æ–—æå†™"
       elif scene_type == "Emotional":
           query = "æƒ…æ„Ÿæå†™ å¿ƒç†æ´»åŠ¨"
       elif scene_type == "Dialogue":
           query = "å¯¹è¯æå†™ äººç‰©å¯¹è¯"
       else:
           query = "å¸¸è§„æå†™"
       
       style_results = await vs.search_style(query, top_k=3)
       
       # èåˆå¤šæ¡å‚è€ƒ
       style_context = "\n\n".join([
           f"ã€æ–‡é£å‚è€ƒ {i+1}ã€‘\n{r['content']}" 
           for i, r in enumerate(style_results)
       ])
       return style_context
   ```

2. **æ–‡é£ç‰¹å¾æå–å’Œåº”ç”¨**
   - åˆ†ææ–‡é£å‚è€ƒçš„å¥å¼ç‰¹ç‚¹
   - æå–ä¿®è¾æ‰‹æ³•
   - åœ¨ Writer Agent ä¸­æ˜¾å¼åº”ç”¨

3. **åŠ¨æ€æ–‡é£è°ƒæ•´**
   - æ ¹æ®ç« èŠ‚å†…å®¹åŠ¨æ€è°ƒæ•´æ–‡é£
   - ä¿æŒæ•´ä½“é£æ ¼ä¸€è‡´æ€§çš„åŒæ—¶å…è®¸å±€éƒ¨å˜åŒ–

**ä¼˜å…ˆçº§**: â­â­â­â­ (ä¸­é«˜)

---

#### é—®é¢˜ 6: èµ„æ–™åº“å†…å®¹åˆ©ç”¨ä¸å……åˆ†

**ç°çŠ¶**:
- ReferenceMaterial ä¸­çš„å‰§æƒ…å¥—è·¯ã€äººç‰©åŸå‹ç­‰æ²¡æœ‰è¢«å……åˆ†åˆ©ç”¨
- åªåœ¨ç”Ÿæˆå¤§çº²æ—¶ä½¿ç”¨ï¼Œå†™ä½œé˜¶æ®µä¸ä½¿ç”¨

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **åœ¨å†™ä½œé˜¶æ®µæ£€ç´¢å‰§æƒ…å¥—è·¯**
   ```python
   # åœ¨ write_node ä¹‹å‰
   plot_tropes = await vs.search_references(
       f"{plan_data['key_conflict']} {plan_data['scene_description']}",
       top_k=2,
       category="plot_trope"
   )
   ```

2. **äººç‰©åŸå‹åŒ¹é…**
   - æ ¹æ®å½“å‰ç« èŠ‚æ¶‰åŠçš„äººç‰©ï¼Œæ£€ç´¢ç›¸ä¼¼çš„äººç‰©åŸå‹
   - æä¾›äººç‰©è¡Œä¸ºå‚è€ƒ

3. **åœºæ™¯æ¨¡æ¿å‚è€ƒ**
   - æ£€ç´¢ç±»ä¼¼åœºæ™¯çš„æå†™æ¨¡æ¿
   - æä¾›ç»“æ„å‚è€ƒ

**ä¼˜å…ˆçº§**: â­â­â­ (ä¸­)

---

### ä¸‰ã€å‰§æƒ…çº¿å®Œæ•´åº¦ä¼˜åŒ–

#### é—®é¢˜ 7: ä¼ç¬”ç®¡ç†ä¸å¤Ÿä¸»åŠ¨

**ç°çŠ¶**:
- ä¼ç¬”åªåœ¨ evolve èŠ‚ç‚¹è¢«åŠ¨æ›´æ–°
- plan èŠ‚ç‚¹è™½ç„¶èƒ½çœ‹åˆ°ä¼ç¬”ï¼Œä½†æ²¡æœ‰ä¸»åŠ¨æ¨è¿›æˆ–å›æ”¶çš„ç­–ç•¥
- æ²¡æœ‰æ£€æŸ¥ä¼ç¬”æ˜¯å¦è¿‡æœŸæˆ–é—å¿˜

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **åœ¨ plan èŠ‚ç‚¹ä¸»åŠ¨ç®¡ç†ä¼ç¬”**
   ```python
   async def plan_with_foreshadowing(state: NGEState) -> dict:
       """è§„åˆ’æ—¶ä¸»åŠ¨è€ƒè™‘ä¼ç¬”"""
       active_threads = state.memory_context.global_foreshadowing
       
       # 1. æ£€æŸ¥æ˜¯å¦æœ‰éœ€è¦å›æ”¶çš„ä¼ç¬”
       threads_to_resolve = []
       for thread in active_threads:
           # æ£€æŸ¥æ˜¯å¦åˆ°äº†å›æ”¶æ—¶æœº
           if should_resolve_thread(thread, state):
               threads_to_resolve.append(thread)
       
       # 2. åœ¨è§„åˆ’ä¸­æ˜¾å¼è¦æ±‚æ¨è¿›æˆ–å›æ”¶ä¼ç¬”
       prompt = f"""
       å½“å‰æœªè§£å†³çš„ä¼ç¬”ï¼š
       {format_threads(active_threads)}
       
       è¯·åœ¨æœ¬ç« è§„åˆ’ä¸­ï¼š
       1. å¦‚æœåˆé€‚ï¼Œæ¨è¿›ä»¥ä¸‹ä¼ç¬”ï¼š{format_threads(threads_to_resolve[:2])}
       2. å¦‚æœåˆé€‚ï¼Œå›æ”¶ä»¥ä¸‹ä¼ç¬”ï¼š{format_threads(threads_to_resolve[:1])}
       3. å¦‚æœåˆé€‚ï¼ŒåŸ‹ä¸‹æ–°çš„ä¼ç¬”
       """
   ```

2. **ä¼ç¬”ç”Ÿå‘½å‘¨æœŸç®¡ç†**
   - è®°å½•ä¼ç¬”åˆ›å»ºæ—¶é—´
   - æ£€æŸ¥ä¼ç¬”æ˜¯å¦è¿‡æœŸï¼ˆå¤ªä¹…æœªæ¨è¿›ï¼‰
   - è‡ªåŠ¨æé†’éœ€è¦å›æ”¶çš„ä¼ç¬”

3. **ä¼ç¬”å…³è”åˆ†æ**
   - åˆ†æä¼ç¬”ä¹‹é—´çš„å…³è”
   - è¯†åˆ«ä¼ç¬”é“¾æ¡
   - è§„åˆ’ä¼ç¬”çš„å›æ”¶é¡ºåº

**ä¼˜å…ˆçº§**: â­â­â­â­â­ (é«˜)

---

#### é—®é¢˜ 8: å‰§æƒ…çº¿å®Œæ•´æ€§æ£€æŸ¥ç¼ºå¤±

**ç°çŠ¶**:
- æ²¡æœ‰æ£€æŸ¥æ˜¯å¦é—æ¼å…³é”®å‰§æƒ…ç‚¹
- å¤§çº²å’Œå®é™…ç”Ÿæˆå†…å®¹å¯èƒ½ä¸ä¸€è‡´
- æ²¡æœ‰éªŒè¯å‰§æƒ…èŠ‚å¥

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **å‰§æƒ…çº¿å®Œæ•´æ€§æ£€æŸ¥ Agent**
   ```python
   class PlotIntegrityChecker:
       """å‰§æƒ…çº¿å®Œæ•´æ€§æ£€æŸ¥å™¨"""
       
       async def check_plot_integrity(
           self, 
           state: NGEState, 
           generated_content: str
       ) -> dict:
           """æ£€æŸ¥å‰§æƒ…å®Œæ•´æ€§"""
           # 1. æ£€æŸ¥æ˜¯å¦è¦†ç›–äº†è§„åˆ’çš„å…³é”®äº‹ä»¶
           # 2. æ£€æŸ¥å‰§æƒ…èŠ‚å¥æ˜¯å¦åˆç†
           # 3. æ£€æŸ¥æ˜¯å¦æœ‰é—æ¼çš„é‡è¦ä¿¡æ¯
           # 4. æ£€æŸ¥ä¸å¤§çº²çš„ä¸€è‡´æ€§
   ```

2. **åœ¨ review èŠ‚ç‚¹æ·»åŠ å®Œæ•´æ€§æ£€æŸ¥**
   - ä¸ä»…æ£€æŸ¥é€»è¾‘ï¼Œè¿˜æ£€æŸ¥å®Œæ•´æ€§
   - è¯„åˆ†åŒ…å«å®Œæ•´æ€§ç»´åº¦

3. **å‰§æƒ…èŠ‚å¥åˆ†æ**
   - åˆ†æå½“å‰ç« èŠ‚çš„èŠ‚å¥ï¼ˆç´§å¼ /èˆ’ç¼“ï¼‰
   - ä¸æ•´ä½“èŠ‚å¥è§„åˆ’å¯¹æ¯”
   - æä¾›èŠ‚å¥è°ƒæ•´å»ºè®®

**ä¼˜å…ˆçº§**: â­â­â­â­ (ä¸­é«˜)

---

#### é—®é¢˜ 9: å¤§çº²ä¸ç”Ÿæˆå†…å®¹ä¸€è‡´æ€§ä¸è¶³

**ç°çŠ¶**:
- å¤§çº²åœ¨ plan èŠ‚ç‚¹ç”Ÿæˆï¼Œä½†å®é™…å†™ä½œå¯èƒ½åç¦»
- æ²¡æœ‰éªŒè¯ç”Ÿæˆå†…å®¹æ˜¯å¦éµå¾ªå¤§çº²

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **å¤§çº²éµå¾ªåº¦æ£€æŸ¥**
   ```python
   async def check_outline_adherence(
       self,
       outline: PlotOutline,
       generated_content: str
   ) -> dict:
       """æ£€æŸ¥ç”Ÿæˆå†…å®¹æ˜¯å¦éµå¾ªå¤§çº²"""
       # 1. æå–å¤§çº²ä¸­çš„å…³é”®è¦ç´ 
       # 2. ä»ç”Ÿæˆå†…å®¹ä¸­æå–å¯¹åº”è¦ç´ 
       # 3. å¯¹æ¯”ä¸€è‡´æ€§
       # 4. è¯„åˆ†
   ```

2. **åœ¨ review èŠ‚ç‚¹æ·»åŠ å¤§çº²æ£€æŸ¥**
   - æ£€æŸ¥åœºæ™¯æè¿°æ˜¯å¦åŒ¹é…
   - æ£€æŸ¥å…³é”®å†²çªæ˜¯å¦ä½“ç°
   - æ£€æŸ¥ä¼ç¬”æ˜¯å¦æŒ‰è®¡åˆ’æ¨è¿›

3. **åŠ¨æ€å¤§çº²è°ƒæ•´**
   - å¦‚æœç”Ÿæˆå†…å®¹æœ‰æ›´å¥½çš„æ–¹å‘ï¼Œå¯ä»¥æ›´æ–°å¤§çº²
   - ä½†è¦è®°å½•å˜æ›´åŸå› 

**ä¼˜å…ˆçº§**: â­â­â­ (ä¸­)

---

## ğŸ¯ ä¼˜åŒ–å®æ–½ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®æ–½ï¼‰

1. âœ… **ç« èŠ‚æ‘˜è¦è´¨é‡æå‡** - ä½¿ç”¨ LLM ç”Ÿæˆç»“æ„åŒ–æ‘˜è¦
2. âœ… **RAG æ£€ç´¢èŒƒå›´æ‰©å±•** - å¢åŠ æ£€ç´¢ç±»å‹å’Œæ•°é‡
3. âœ… **ä¼ç¬”ä¸»åŠ¨ç®¡ç†** - åœ¨ plan èŠ‚ç‚¹ä¸»åŠ¨æ¨è¿›/å›æ”¶ä¼ç¬”

### ä¸­é«˜ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸå®æ–½ï¼‰

4. âš ï¸ **ç« èŠ‚è¿è´¯æ€§æ£€æŸ¥** - æ·»åŠ é€»è¾‘è¿æ¥éªŒè¯
5. âš ï¸ **å…³é”®äº‹ä»¶ç´¢å¼•** - æå–å’Œå¼•ç”¨å…³é”®äº‹ä»¶
6. âš ï¸ **æ–‡é£å‚è€ƒå¢å¼º** - å¤šå‚è€ƒèåˆå’Œåœºæ™¯é€‚é…
7. âš ï¸ **å‰§æƒ…å®Œæ•´æ€§æ£€æŸ¥** - æ·»åŠ å®Œæ•´æ€§éªŒè¯

### ä¸­ä¼˜å…ˆçº§ï¼ˆåç»­ä¼˜åŒ–ï¼‰

8. ğŸ“‹ **èµ„æ–™åº“æ·±åº¦åˆ©ç”¨** - å‰§æƒ…å¥—è·¯ã€äººç‰©åŸå‹ç­‰
9. ğŸ“‹ **å¤§çº²ä¸€è‡´æ€§æ£€æŸ¥** - éªŒè¯ç”Ÿæˆå†…å®¹éµå¾ªå¤§çº²

---

## ğŸ“ å…·ä½“å®æ–½å»ºè®®

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

1. **æ”¹è¿›æ‘˜è¦ç”Ÿæˆ**
   - åˆ›å»º `ChapterSummaryGenerator` Agent
   - ä½¿ç”¨ LLM ç”Ÿæˆç»“æ„åŒ–æ‘˜è¦
   - åœ¨ evolve èŠ‚ç‚¹ä½¿ç”¨æ–°æ‘˜è¦ç”Ÿæˆå™¨

2. **æ‰©å±• RAG æ£€ç´¢**
   - ä¿®æ”¹ `refine_context_node`
   - å¢åŠ æ£€ç´¢ç±»å‹å’Œæ•°é‡
   - ä¼˜åŒ– query æ„å»º

3. **ä¼ç¬”ä¸»åŠ¨ç®¡ç†**
   - åœ¨ `plan_node` ä¸­æ·»åŠ ä¼ç¬”åˆ†æ
   - åœ¨è§„åˆ’æç¤ºè¯ä¸­æ˜¾å¼è¦æ±‚å¤„ç†ä¼ç¬”

### é˜¶æ®µäºŒï¼šå¢å¼ºåŠŸèƒ½ï¼ˆ2-3å‘¨ï¼‰

4. **è¿è´¯æ€§æ£€æŸ¥**
   - åˆ›å»º `CoherenceChecker` Agent
   - åœ¨ plan å’Œ review èŠ‚ç‚¹æ·»åŠ æ£€æŸ¥

5. **å…³é”®äº‹ä»¶ç´¢å¼•**
   - åˆ›å»ºäº‹ä»¶æå–å’Œç´¢å¼•ç³»ç»Ÿ
   - åœ¨ load_context ä¸­åŠ è½½å…³é”®äº‹ä»¶

6. **æ–‡é£å‚è€ƒå¢å¼º**
   - æ”¹è¿›æ–‡é£æ£€ç´¢é€»è¾‘
   - å®ç°å¤šå‚è€ƒèåˆ

### é˜¶æ®µä¸‰ï¼šå®Œå–„åŠŸèƒ½ï¼ˆ3-4å‘¨ï¼‰

7. **å®Œæ•´æ€§æ£€æŸ¥**
   - åˆ›å»º `PlotIntegrityChecker` Agent
   - é›†æˆåˆ° review æµç¨‹

8. **èµ„æ–™åº“æ·±åº¦åˆ©ç”¨**
   - åœ¨å¤šä¸ªèŠ‚ç‚¹ä½¿ç”¨èµ„æ–™åº“
   - å®ç°åœºæ™¯æ¨¡æ¿åŒ¹é…

9. **å¤§çº²ä¸€è‡´æ€§**
   - æ·»åŠ å¤§çº²éµå¾ªåº¦æ£€æŸ¥
   - å®ç°åŠ¨æ€å¤§çº²è°ƒæ•´

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. ç»“æ„åŒ–æ‘˜è¦ç”Ÿæˆ

```python
# src/agents/summarizer.py
class ChapterSummarizer(BaseAgent):
    """ç« èŠ‚æ‘˜è¦ç”Ÿæˆå™¨"""
    
    async def generate_summary(
        self, 
        content: str, 
        state: NGEState
    ) -> Dict[str, Any]:
        """ç”Ÿæˆç»“æ„åŒ–æ‘˜è¦"""
        prompt = f"""
        è¯·ä¸ºä»¥ä¸‹ç« èŠ‚ç”Ÿæˆç»“æ„åŒ–æ‘˜è¦ï¼š
        
        ç« èŠ‚å†…å®¹ï¼š
        {content[:3000]}
        
        å¿…é¡»åŒ…å«ï¼š
        1. æ ¸å¿ƒäº‹ä»¶ï¼ˆ1-2å¥è¯ï¼‰
        2. å…³é”®äººç‰©çŠ¶æ€å˜åŒ–
        3. æ–°å‡ºç°çš„ä¼ç¬”æˆ–çº¿ç´¢
        4. ä¸ä¸»çº¿çš„å…³è”
        5. é‡è¦å¯¹è¯æˆ–è¡ŒåŠ¨
        """
        # è°ƒç”¨ LLM å¹¶è§£æç»“æ„åŒ–ç»“æœ
```

### 2. å¢å¼ºçš„ RAG æ£€ç´¢

```python
# ä¿®æ”¹ src/graph.py refine_context_node
async def refine_context_node(self, state: NGEState):
    """å¢å¼ºçš„ä¸Šä¸‹æ–‡ç²¾ç‚¼"""
    query = self._build_rag_query(state, plan_data)
    
    # å¹¶è¡Œæ£€ç´¢å¤šç§èµ„æ–™
    results = await asyncio.gather(
        vs.search_bible(query, top_k=5),
        vs.search_style(query, top_k=3),
        vs.search_references(query, top_k=2, category="plot_trope"),
        vs.search_references(query, top_k=2, category="character_archetype"),
    )
    
    # èåˆç»“æœ
    enhanced_context = self._merge_rag_results(results)
```

### 3. ä¼ç¬”ä¸»åŠ¨ç®¡ç†

```python
# ä¿®æ”¹ src/graph.py plan_node
async def plan_node(self, state: NGEState):
    # åˆ†æä¼ç¬”
    foreshadowing_analysis = await self._analyze_foreshadowing(state)
    
    # åœ¨è§„åˆ’æç¤ºè¯ä¸­åŒ…å«ä¼ç¬”è¦æ±‚
    plan_prompt = f"""
    å½“å‰æœªè§£å†³ä¼ç¬”ï¼š
    {format_threads(state.memory_context.global_foreshadowing)}
    
    ä¼ç¬”åˆ†æï¼š
    - å»ºè®®æ¨è¿›ï¼š{foreshadowing_analysis['to_advance']}
    - å»ºè®®å›æ”¶ï¼š{foreshadowing_analysis['to_resolve']}
    
    è¯·åœ¨è§„åˆ’ä¸­è€ƒè™‘è¿™äº›ä¼ç¬”ã€‚
    """
```

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### è¿è´¯æ€§æå‡
- **ç« èŠ‚è¡”æ¥**: ä» 60% â†’ 90%
- **é€»è¾‘ä¸€è‡´æ€§**: ä» 70% â†’ 95%
- **å…³é”®äº‹ä»¶å¼•ç”¨**: ä» 30% â†’ 80%

### èµ„æ–™ä½¿ç”¨æå‡
- **èµ„æ–™æ£€ç´¢è¦†ç›–ç‡**: ä» 40% â†’ 85%
- **æ–‡é£ä¸€è‡´æ€§**: ä» 65% â†’ 90%
- **å‰§æƒ…å¥—è·¯åº”ç”¨**: ä» 20% â†’ 70%

### å‰§æƒ…å®Œæ•´åº¦æå‡
- **ä¼ç¬”å›æ”¶ç‡**: ä» 50% â†’ 85%
- **å¤§çº²éµå¾ªåº¦**: ä» 70% â†’ 95%
- **å‰§æƒ…å®Œæ•´æ€§**: ä» 65% â†’ 90%

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**: å®æ–½é«˜ä¼˜å…ˆçº§ä¼˜åŒ–ï¼ˆæ‘˜è¦ç”Ÿæˆã€RAGæ‰©å±•ã€ä¼ç¬”ç®¡ç†ï¼‰
2. **å‡†å¤‡èµ„æº**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„ API é…é¢ç”¨äºæ‘˜è¦ç”Ÿæˆ
3. **æµ‹è¯•éªŒè¯**: æ¯ä¸ªä¼˜åŒ–éƒ½è¦æœ‰æµ‹è¯•ç”¨ä¾‹å’Œæ•ˆæœéªŒè¯
4. **è¿­ä»£æ”¹è¿›**: æ ¹æ®å®é™…æ•ˆæœè°ƒæ•´ä¼˜åŒ–æ–¹æ¡ˆ

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2026-01-07*  
*åˆ†æå·¥å…·: Auto (Cursor AI)*
